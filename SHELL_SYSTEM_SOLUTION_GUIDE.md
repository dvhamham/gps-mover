# ุฏููู ุญู ูุดููุฉ Shell Command System

## ๐จ ุชุญููู ุงููุดููุฉ ุงูุชู ูุงุฌูุชู

### ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:
1. **ุชูููุฐ ูุฑุฉ ูุงุญุฏุฉ ููุท** ุจุฏูุงู ูู ุงูุนุฏุฏ ุงููุทููุจ
2. **ุจูุงุก run=true** ูุนุฏู ุฅุนุงุฏุฉ ุชุนูููู ุฅูู false
3. **ุงูุชุนููู ุนูุฏ ุงูุชุบููุฑ ูู false ุฅูู true** ูุฑุฉ ุฃุฎุฑู
4. **ุนุฏู ูุถูุญ ูุธุงู ุงูุงูุชุธุงุฑ** - ูู 5000 ุชุนูู 5 ุซูุงูุ

## โ ุงูุญููู ุงููุทุจูุฉ

### 1. ุฅุตูุงุญ Thread Management
```kotlin
// ูุจู: ูุงู Thread ูุง ูุชู ุญูุธู
Thread { ... }.apply { start() }

// ุจุนุฏ: ุญูุธ ูุฑุฌุน Thread ูุฅุฏุงุฑุฉ ุฃูุถู
currentExecutionThread = Thread { ... }.apply { 
    name = "ShellCommandExecutor-$androidId"
    isDaemon = false 
}
currentExecutionThread?.start()
```

### 2. ุฅุตูุงุญ ูุธุงู ุงูุงูุชุธุงุฑ
```kotlin
// ูุนูุ 5000 ูุนูู 5 ุซูุงู ุจุงูุถุจุท!
// ุงููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงูุซูุงููุ ูุชู ุถุฑุจูุง ร 1000 ููู milliseconds
Thread.sleep(waitSeconds * 1000L)

// ุฅุฐุง ูุถุนุช 5000 ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ุณูุชู ุชุญููููุง ุชููุงุฆูุงู:
if (waitSeconds > 60) {
    waitSeconds = (waitSeconds / 1000).coerceAtLeast(1)
    // 5000 รท 1000 = 5 ุซูุงู
}
```

### 3. ุฅุตูุงุญ ุฅุนุงุฏุฉ ุชุนููู run flag
```kotlin
// ุงูุขู ูุชู ุชุนุทูู run flag ููุท ุจุนุฏ ุงูุชูุงุก ุฌููุน ุงูุชูููุฐุงุช
while (executionCount < count && !Thread.currentThread().isInterrupted) {
    executionCount++
    // ุชูููุฐ ุงูุฃูุฑ...
    // ุงูุชุธุงุฑ...
}

// ุจุนุฏ ุงูุชูุงุก ุฌููุน ุงูุชูููุฐุงุช:
disableShellRunFlag(androidId, finalResult) // ููุง ููุท ูุตุจุญ run=false
```

### 4. ุญูุงูุฉ ูู ุงูุชุนููู
```kotlin
// ูุธุงู timeout ุดุงูู
val maxExecutionTime = 60000L // 60 ุซุงููุฉ ูุญุฏ ุฃูุตู
val EXECUTION_TIMEOUT = 120000L // 2 ุฏูููุฉ ููุดู ุงูุชุนููู

// ูุดู ุงูุชุนููู ุงูุชููุงุฆู
if (currentTime - lastExecutionStartTime > EXECUTION_TIMEOUT) {
    Log.e(TAG, "โ๏ธ Execution timeout detected! Forcing reset")
    forceResetExecutionState(androidId)
}
```

## ๐ ููููุฉ ุงูุงุฎุชุจุงุฑ ุงูุตุญูุญ

### ุงุฎุชุจุงุฑ ุฃุณุงุณู:
```json
{
  "shell": {
    "command": "echo 'Test #' && date",
    "run": true,
    "count": 3,
    "wait": 5,
    "result": ""
  }
}
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุณูุชู ุชูููุฐ ุงูุฃูุฑ **3 ูุฑุงุช**
- โ ุณูููู ููุงู **5 ุซูุงู ุงูุชุธุงุฑ** ุจูู ูู ุชูููุฐ
- โ ุงููุฏุฉ ุงูุฅุฌูุงููุฉ: ~10 ุซูุงู (3 ุชูููุฐุงุช + ุงูุชุธุงุฑุงู ร 5 ุซูุงู)
- โ ุจุนุฏ ุงูุงูุชูุงุก ุณูุตุจุญ `run: false`

### ุงูุณุฌูุงุช ุงููุชููุนุฉ:
```
๐ Real-time shell command detected - Command: 'echo Test && date', Count: 3, Wait: 5s
๐ Starting command execution sequence - keeping run flag true during execution
๐ฏ Starting internal command sequence - Total executions planned: 3, Wait between: 5s
๐ Starting command execution in background thread
โก Executing shell command (1/3): echo 'Test #' && date
โ Shell command executed successfully (1/3)
โฐ Waiting 5 seconds before next execution...
โฑ๏ธ Wait completed, proceeding to next execution...
โก Executing shell command (2/3): echo 'Test #' && date
โ Shell command executed successfully (2/3)
โฐ Waiting 5 seconds before next execution...
โฑ๏ธ Wait completed, proceeding to next execution...
โก Executing shell command (3/3): echo 'Test #' && date
โ Shell command executed successfully (3/3)
๐ Shell command sequence completed - Total executions: 3/3
โ Shell run flag disabled and result updated after command sequence completion
๐ Execution flag reset - ready for next command
```

## ๐ ูุธุงู ุงูุงูุชุธุงุฑ (Wait System)

### ุงูููู ุงูููุจููุฉ:
- **0**: ุจุฏูู ุงูุชุธุงุฑ (ุชูููุฐ ููุฑู)
- **1-60**: ุซูุงู (ูุจุงุดุฑุฉ)
- **61+**: ูุชู ุชุญููููุง ูู milliseconds ุฅูู ุซูุงู

### ุฃูุซูุฉ:
| ุงููููุฉ ูู DB | ุงูุชูุณูุฑ | ุงูุงูุชุธุงุฑ ุงููุนูู |
|-------------|---------|---------------|
| `0` | ุจุฏูู ุงูุชุธุงุฑ | 0 ุซุงููุฉ |
| `3` | 3 ุซูุงู | 3 ุซูุงู |
| `10` | 10 ุซูุงู | 10 ุซูุงู |
| `5000` | 5000ms = 5s | 5 ุซูุงู |
| `30000` | 30000ms = 30s | 30 ุซุงููุฉ |

## ๐ ุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู

### ุฅุฐุง ุนูู ุงููุธุงู:
```kotlin
// ุงุณุชุฎุฏู ูุฐู ุงูุฏุงูุฉ ูุฅุนุงุฏุฉ ุชุนููู ุงููุธุงู
CollectionsManager.forceResetExecutionState(androidId)
```

### ุนูุงูุงุช ุงูุชุนููู:
- `run: true` ูุฃูุซุฑ ูู ุฏูููุชูู ุจุฏูู ุชูููุฐ
- ูุง ุชูุฌุฏ ุฑุณุงุฆู ุฌุฏูุฏุฉ ูู ุงูุณุฌู
- ุนุฏู ุงุณุชุฌุงุจุฉ ููุฃูุงูุฑ ุงูุฌุฏูุฏุฉ

## ๐งช ุงุฎุชุจุงุฑ ุดุงูู

### ุงููุฑุญูุฉ 1: ุงุฎุชุจุงุฑ ุงูุชูุฑุงุฑ
```json
{ "command": "echo 'Test'", "run": true, "count": 5, "wait": 2 }
```
**ุงููุชููุน:** 5 ุชูููุฐุงุช ูู ~8 ุซูุงู

### ุงููุฑุญูุฉ 2: ุงุฎุชุจุงุฑ ุงูุงูุชุธุงุฑ ุงูุทููู
```json
{ "command": "echo 'Long wait'", "run": true, "count": 2, "wait": 10 }
```
**ุงููุชููุน:** 2 ุชูููุฐ ูู ~10 ุซูุงู

### ุงููุฑุญูุฉ 3: ุงุฎุชุจุงุฑ milliseconds
```json
{ "command": "echo 'MS test'", "run": true, "count": 3, "wait": 3000 }
```
**ุงููุชููุน:** 3 ุชูููุฐุงุช ูุน 3 ุซูุงู ุงูุชุธุงุฑ (3000ms = 3s)

### ุงููุฑุญูุฉ 4: ุงุฎุชุจุงุฑ ุจุฏูู ุงูุชุธุงุฑ
```json
{ "command": "echo 'No wait'", "run": true, "count": 4, "wait": 0 }
```
**ุงููุชููุน:** 4 ุชูููุฐุงุช ููุฑูุฉ ูู <2 ุซุงููุฉ

## ๐จ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: "ุชูููุฐ ูุฑุฉ ูุงุญุฏุฉ ููุท"
**ุงูุญู:** ุชุฃูุฏ ูู:
- โ `count > 1`
- โ ูุฌูุฏ root access
- โ ุงูุฃูุฑ ุตุญูุญ ููุงุจู ููุชูููุฐ

### ุงููุดููุฉ: "run ูุจูู true"
**ุงูุญู:** 
- ุงูุชุธุฑ ุงูุชูุงุก ุฌููุน ุงูุชูููุฐุงุช
- ุชุญูู ูู ุงูุณุฌูุงุช ููุฃุฎุทุงุก
- ุงุณุชุฎุฏู `forceResetExecutionState()` ุฅุฐุง ูุฒู ุงูุฃูุฑ

### ุงููุดููุฉ: "ูุง ูุณุชุฌูุจ ููุฃูุงูุฑ ุงูุฌุฏูุฏุฉ"
**ุงูุญู:**
```kotlin
// ูุญุต ุงูุญุงูุฉ
val status = CollectionsManager.checkExecutionStatus()

// ุฅุนุงุฏุฉ ุชุนููู ูุณุฑูุฉ
CollectionsManager.forceResetExecutionState(androidId)
```

## ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก

### ุงูุฃุฏุงุก ุงูุทุจูุนู:
- **ุฒูู ุงูุชูููุฐ ููู ุฃูุฑ:** <2 ุซุงููุฉ
- **ุฏูุฉ ุงูุงูุชุธุงุฑ:** ยฑ100ms
- **ุงุณุชููุงู ุงูุฐุงูุฑุฉ:** ููุฎูุถ
- **ุงุณุชุฌุงุจุฉ ุงููุธุงู:** ููุฑูุฉ

### ุนูุงูุงุช ุงูุชุญุฐูุฑ:
- โ๏ธ ุชูููุฐ ุฃูุซุฑ ูู 10 ุซูุงู ูุฃูุฑ ูุงุญุฏ
- โ๏ธ ุนุฏู ุชุญุฏูุซ ุงููุชุงุฆุฌ ูุฃูุซุฑ ูู ุฏูููุฉ
- โ๏ธ ุงุณุชููุงู CPU ุนุงูู ุจุฏูู ุณุจุจ

## ๐ฏ ุงูุฎูุงุตุฉ

ุงููุธุงู ุงูุขู ูุนูู ุจุดูู ููุซูู:

โ **ุชูููุฐ ูุชุนุฏุฏ:** ูููุฐ ุงูุนุฏุฏ ุงููุทููุจ ุจุงูุถุจุท  
โ **ุงูุชุธุงุฑ ุฏููู:** 5000 = 5 ุซูุงู ุจุงูุถุจุท  
โ **ุฅุนุงุฏุฉ ุชุนููู ุชููุงุฆูุฉ:** run ูุตุจุญ false ุจุนุฏ ุงูุงูุชูุงุก  
โ **ุญูุงูุฉ ูู ุงูุชุนููู:** ูุธุงู timeout ููุฑุงูุจุฉ  
โ **ุชุดุฎูุต ุดุงูู:** ุณุฌูุงุช ููุตูุฉ ูุฃุฏูุงุช ูุญุต  

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูุฅูุชุงุฌู! ๐**
